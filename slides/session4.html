<!DOCTYPE html>
<html lang="en"><head>
<script src="session4_files/libs/clipboard/clipboard.min.js"></script>
<script src="session4_files/libs/quarto-html/tabby.min.js"></script>
<script src="session4_files/libs/quarto-html/popper.min.js"></script>
<script src="session4_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="session4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="session4_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="session4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.1.189">

  <meta name="author" content="Cl√©mentine Cottineau">
  <title>Session 4: Combining Vector and Raster Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="session4_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="session4_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="session4_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link rel="stylesheet" href="logo.css">
  <link href="session4_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="session4_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="session4_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="session4_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="session4_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="session4_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="session4_files/libs/countdown-0.4.0/countdown.css" rel="stylesheet">
  <script src="session4_files/libs/countdown-0.4.0/countdown.js"></script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">Session 4: Combining Vector and Raster Data</h1>
  <p class="author">Cl√©mentine Cottineau</p>
</section>

<section>
<section id="session-4a-vector-data-from-openstreetmap" class="title-slide slide level1 center">
<h1>Session 4a: Vector data from OpenStreetMap</h1>

</section>
<section id="objectives" class="slide level2">
<h2>Objectives:</h2>
<ul>
<li class="fragment">Explain how <strong>OpenStreetMap</strong> (OSM) geodata works</li>
<li class="fragment">Demonstrate how to <strong>import, select, and visualise OSM vector data</strong></li>
</ul>
</section>
<section id="open-street-map-osm" class="slide level2">
<h2>Open Street Map (OSM)</h2>
<p>is a collaborative project which aims at mapping the world and sharing geospatial data in an open way.</p>

<img data-src="fig/OSM1.png" class="r-stretch quarto-figure-center"></section>
<section id="osm" class="slide level2">
<h2>OSM üó∫</h2>
<p>Anyone can contribute, by mapping geographical objects their encounter by</p>
<ul>
<li class="fragment"><strong>mapping spatial features</strong> (e.g.&nbsp;buildings or roads), from located device or satellite imagery.</li>
<li class="fragment">adding <strong>topical information</strong> on existing map objects (their name, function, capacity, etc.)</li>
</ul>
</section>
<section id="osm-1" class="slide level2">
<h2>OSM üó∫</h2>
<ul>
<li class="fragment">This information is then <strong>validated</strong> by other users and eventually added to the common ‚Äúmap‚Äù or information system.</li>
<li class="fragment">This ensures that the information is <strong>accessible, open, verified, accurate</strong> and <strong>up-to-date</strong>. cf.&nbsp;HOT: Humanitarian OpenStreetMap Team</li>
</ul>
</section>
<section id="osm-2" class="slide level2">
<h2>OSM üó∫</h2>
<p>The geospatial data underlying this interface is made of geometrical objects (i.e.&nbsp;points, lines, polygons) and their associated tags (#building #height, #road #secondary #90kph, etc.).</p>
</section>
<section id="how-to-extract-geospatial-data-from-open-street-map-with-r" class="slide level2">
<h2>How to extract geospatial data from Open Street Map with R?</h2>
<p>The first thing to do is to define the area within which you want to retrieve data, aka the <em>bounding box</em>. This can be defined easily using a place name and the function <code>getbb()</code> from the package <code>osmdata</code>.</p>
<blockquote>
<p>‚ÄúThis function uses the free Nominatim API provided by OpenStreetMap to find the bounding box (bb) associated with place names.‚Äù</p>
</blockquote>
</section>
<section id="the-bounding-box" class="slide level2">
<h2>The Bounding Box ‚¨õ</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">getbb</span>(<span class="st">'Delft'</span>, <span class="at">format_out =</span> <span class="st">'sf_polygon'</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>bb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 0 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 4.320218 ymin: 9.474415 xmax: 79.73152 ymax: 52.0326
Geodetic CRS:  WGS 84
                        geometry
1 POLYGON ((4.320218 52.00807...
2 POLYGON ((4.320218 52.00807...
3 POLYGON ((79.65064 9.541313...</code></pre>
</div>
</div>
<p>A Problem with download? Try:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">assign</span>(<span class="st">"has_internet_via_proxy"</span>, <span class="cn">TRUE</span>, <span class="fu">environment</span>(curl<span class="sc">::</span>has_internet))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Why multiple polygons?</p>
<p>Because there are different responses from the API query, corresponding to different objects at the same location, or different objects are different locations.</p>
</section>
<section id="extracting-osm-features" class="slide level2">
<h2>Extracting OSM features</h2>
<p>A <a href="https://wiki.openstreetmap.org/wiki/Map_features">feature</a> in the OSM language is a category or tag of a geospatial object. <strong>Features</strong> are described by general keys (e.g.&nbsp;‚Äúbuilding‚Äù, ‚Äúboundary‚Äù, ‚Äúlanduse‚Äù, ‚Äúhighway‚Äù) Features are decomposed into sub-categories (values) such as ‚Äúfarm‚Äù, ‚Äúhotel‚Äù or ‚Äúhouse‚Äù for <code>buildings</code>, ‚Äúmotorway‚Äù, ‚Äúsecondary‚Äù and ‚Äúresidential‚Äù for <code>highway</code>. This determines how they are represented on the map.</p>
</section>
<section id="extracting-osm-features-1" class="slide level2">
<h2>Extracting OSM features</h2>
<p>We use the function <code>opq()</code> that stands for ‚Äúoverpass query‚Äù.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>x <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span> bb) <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2"></a>   <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">'building'</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="fu">osmdata_sf</span> ()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is this x object made of?</p>
</section>
<section id="extracting-osm-features-2" class="slide level2">
<h2>Extracting OSM features</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">head</span>(x<span class="sc">$</span>osm_polygons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">It is a <strong>table</strong> of all the buildings contained in the bounding box, which gives us their <strong>OSM id</strong>, their <strong>geometry</strong> and a range of <strong>attributes</strong>, such as their name, building material, building date, etc.</li>
<li class="fragment">The <strong>completion</strong> level of this table depends on user contributions and open resources (here for instance: BAG, different in other countries).</li>
</ul>
</section>
<section id="mapping-attributes" class="slide level2">
<h2>Mapping attributes</h2>
<p>Case Study: we are interested in mapping urbanisation in Delft in the 20th and 21st centuries. We need to look into specific attributes:</p>
<ul>
<li class="fragment">the <strong>building age</strong> of buildings</li>
<li class="fragment">with a <strong>subset</strong> of buildings from after 1900</li>
<li class="fragment">within the <strong>Delft</strong> bounding box</li>
</ul>
</section>
<section id="projections" class="slide level2">
<h2>Projections</h2>
<p>First, we are going to select the polygons and reproject them with the Amersfoort/RD New projection, suited for maps centered on the Netherlands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>buildings <span class="ot">&lt;-</span> x<span class="sc">$</span>osm_polygons <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">st_transform</span>(.,<span class="at">crs=</span><span class="dv">28992</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mapping-urbanisation-in-delft" class="slide level2">
<h2>Mapping urbanisation in Delft</h2>
<p>Then we create a variable which a threshold at 1900. Every date prior to 1900 will be recoded 1900, so that buildings older than 1900 will be represented with the same shade.</p>
<p>Then we use the <code>ggplot</code> function to visualise the buildings by age. The specific function to represent information as a map is <code>geom_sf()</code>. The rest works like other graphs and visualisation, with <code>aes()</code> for the aesthetics.</p>
</section>
<section id="mapping-urbanisation-in-delft-1" class="slide level2">
<h2>Mapping urbanisation in Delft</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">summary</span>(buildings<span class="sc">$</span>start_date)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>buildings<span class="sc">$</span>build_date <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ifelse</span>(buildings<span class="sc">$</span>start_date <span class="sc">&lt;</span><span class="dv">1900</span>, <span class="dv">1900</span>,buildings<span class="sc">$</span>start_date))</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a> <span class="fu">ggplot</span>(<span class="at">data =</span> buildings) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>   <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> build_date, <span class="at">colour=</span>build_date))  <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>   <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>)<span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>   <span class="fu">scale_colour_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mapping-urbanisation-in-delft-2" class="slide level2">
<h2>Mapping urbanisation in Delft</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="fig/rmd-04a-map-age-1.png"></p>
</figure>
</div>
</div><div class="column" style="width:40%;">
<ul>
<li class="fragment">the historical centre of Delft</li>
<li class="fragment">the first ring in the 1920s</li>
<li class="fragment">the South-West extension (1970s-1990s)</li>
<li class="fragment">East (2000s)</li>
<li class="fragment">North-West (2010s).</li>
</ul>
</div>
</div>
</section>
<section id="mapping-urbanisation-in-delft-3" class="slide level2">
<h2>Mapping urbanisation in Delft</h2>
<p>This centre-periphery and sectoral urban development is quite common. Now for a less typical example, can you reproduce this map for the city of <strong>Rotterdam</strong>. But instead of pre-1900 building, we want to look at <strong>post-war buildings</strong>.</p>
<p><em>It will take some time to extract all buildings, so we will check the result after the coffee break.</em></p>
</section>
<section id="challenge-post-war-buildings-rdam" class="slide level2">
<h2>‚è∞ Challenge: post-war buildings, R‚Äôdam</h2>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_4d2b2878" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">‚àí</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">20</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>

<img data-src="fig/rmd-04a-unnamed-chunk-2-1.png" class="r-stretch quarto-figure-center"><p>A Problem with download? Try:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">assign</span>(<span class="st">"has_internet_via_proxy"</span>, <span class="cn">TRUE</span>, <span class="fu">environment</span>(curl<span class="sc">::</span>has_internet))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="solution" class="slide level2">
<h2>Solution</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">getbb</span>(<span class="st">'Rotterdam'</span>, <span class="at">format_out =</span> <span class="st">'sf_polygon'</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>x <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span> bb) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">'building'</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="fu">osmdata_sf</span> ()</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a>buildings <span class="ot">&lt;-</span> x<span class="sc">$</span>osm_polygons <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">st_transform</span>(.,<span class="at">crs=</span><span class="dv">28992</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a>buildings<span class="sc">$</span>build_date <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="fu">ifelse</span>(buildings<span class="sc">$</span>start_date <span class="sc">&lt;</span><span class="dv">1945</span>,</span>
<span id="cb9-11"><a href="#cb9-11"></a>         <span class="dv">1945</span>,</span>
<span id="cb9-12"><a href="#cb9-12"></a>         buildings<span class="sc">$</span>start_date))</span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="fu">ggplot</span>(<span class="at">data =</span> buildings) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> build_date, <span class="at">colour=</span>build_date))  <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>)<span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary-and-keypoints" class="slide level2">
<h2>Summary and keypoints</h2>
<p>We have seen how OpenStreetMap (OSM) geodata works and how to import, select, and visualise OSM vector data.</p>
<p>In short:</p>
<ul>
<li class="fragment">Use the <code>osmextract</code> package</li>
<li class="fragment">Select features and attributes among osm tags</li>
<li class="fragment">Use the <code>ggplot</code> package to map OSM data</li>
</ul>
</section></section>
<section>
<section id="session-4b-basic-gis-operations-with-the-sf-package" class="title-slide slide level1 center">
<h1>Session 4b: Basic GIS operations with the <code>sf</code> package</h1>

</section>
<section id="objectives-1" class="slide level2">
<h2>Objectives:</h2>
<ul>
<li class="fragment">Show how to create spatial <strong>buffers and centroids</strong></li>
<li class="fragment">Demonstrate how to <strong>intersect</strong> vector data</li>
<li class="fragment">Present the function to retrieve the <strong>area</strong> of polygons</li>
</ul>
</section>
<section id="the-sf-package" class="slide level2">
<h2>the ‚Äòsf‚Äô package üì•</h2>
<ul>
<li class="fragment"><p><code>sf</code> is a package which supports simple features (sf), <a href="https://cran.r-project.org/web/packages/sf/sf.pdf">‚Äúa standardized way to encode spatial vector data.‚Äù</a>.</p></li>
<li class="fragment"><p>It contains a large set of functions to achieve all the operations on vector spatial data for which you might use traditional GIS software: change the coordinate system, join layers, intersect or unit polygons, create buffers and centroids, etc. cf.&nbsp;the <code>sf</code> <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/sf.pdf">cheatsheet</a>.</p></li>
<li class="fragment"><p>We are going to go through some of these basics with the case study of Rotterdam buildings.</p></li>
</ul>
</section>
<section id="conservation-in-rotterdam" class="slide level2">
<h2>Conservation in Rotterdam üè¶</h2>
<p>Let‚Äôs focus on really old building and imagine we‚Äôre in charge of their conservation. We want to know <strong>how much of the city would be affected by a non-construction zone of 500m around pre-1800 buildings</strong>.</p>
<p>Let‚Äôs select them and see where they are.</p>
</section>
<section id="conservation-in-rotterdam-1" class="slide level2">
<h2>Conservation in Rotterdam üè¢</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>old <span class="ot">&lt;-</span> <span class="dv">1800</span> <span class="co"># year prior to which you consider a building old</span></span>
<span id="cb10-2"><a href="#cb10-2"></a> </span>
<span id="cb10-3"><a href="#cb10-3"></a>old_buildings <span class="ot">&lt;-</span> buildings <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">filter</span>(start_date <span class="sc">&lt;=</span> old)</span>
<span id="cb10-5"><a href="#cb10-5"></a> <span class="fu">ggplot</span>(<span class="at">data =</span> old_buildings) <span class="sc">+</span> <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="fig/rmd-04b-old-buildings-1.png" class="r-stretch quarto-figure-center"></section>
<section id="challenge-make-it-more-visible" class="slide level2">
<h2>‚è∞Challenge: make it more visible!</h2>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_e05cd5a8" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">‚àí</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<p>Make the buildings show in red on the ‚Äúmap‚Äù</p>
</section>
<section id="solution-one-of-them" class="slide level2">
<h2>Solution (one of them)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>old_buildings) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">geom_sf</span>(<span class="at">colour=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="fig/rmd-04b-old-buildings-1-red.png"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="basic-gis-operations" class="slide level2">
<h2>Basic GIS operations</h2>
<p>As conservationists, we want to create a zone around historical buildings where building regulation will have special restrictions to preserve historical buildings.</p>
</section>
<section id="buffer" class="slide level2">
<h2>Buffer</h2>
<p>Let‚Äôs say this zone should be 500 meters. In GIS terms, we want to create a buffer around polygons. The corresponding function <code>sf</code> is <code>st_buffer</code>, with 2 arguments:</p>
<ul>
<li class="fragment">‚Äúx‚Äù: the polygons around which to create buffers</li>
<li class="fragment">‚Äúdist‚Äù: the radius of the buffer.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a> distance <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co"># in meters </span></span>
<span id="cb12-2"><a href="#cb12-2"></a> buffer_old_buildings <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(<span class="at">x =</span> old_buildings, <span class="at">dist =</span> distance)</span>
<span id="cb12-3"><a href="#cb12-3"></a> <span class="fu">ggplot</span>(<span class="at">data =</span> buffer_old_buildings) <span class="sc">+</span> <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="buffer-1" class="slide level2">
<h2>Buffer</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a> <span class="fu">ggplot</span>(<span class="at">data =</span> buffer_old_buildings) <span class="sc">+</span> <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="fig/rmd-04b-buffers-1.png" class="r-stretch quarto-figure-center"></section>
<section id="union" class="slide level2">
<h2>Union</h2>
<p>Now, we have a lot of overlapping buffers. We would rather create a <strong>unique</strong> conservation zone rather than overlapping ones in that case. So we have to fuse (or dissolve) the overlapping buffers into one polygon. This operation is called <strong>union</strong> in <code>sf</code> and the corresponding function is <code>st_union</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a> single_old_buffer <span class="ot">&lt;-</span> <span class="fu">st_union</span>(buffer_old_buildings) <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">st_cast</span>(<span class="at">to =</span> <span class="st">"POLYGON"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">st_as_sf</span>()  </span>
<span id="cb14-4"><a href="#cb14-4"></a>single_old_buffer <span class="ot">&lt;-</span> single_old_buffer <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">add_column</span>(<span class="st">"ID"</span><span class="ot">=</span><span class="fu">as.factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(single_old_buffer)))  <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">st_transform</span>(.,<span class="at">crs=</span><span class="dv">28992</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also use <code>st_cast()</code> to explicit the type of the resulting object (<em>POLYGON</em> instead of the default <em>MULTIPOLYGON</em>), <code>st_as_sf()</code> to transform the polygon into an <code>sf</code> object.</p>
</section>
<section id="centroids" class="slide level2">
<h2>Centroids</h2>
<p>For the sake of visualisation speed, we would like to represent buildings by a single point (for instance: their geometric centre) rather than their actual footprint.</p>
<p>This operation means defining their centroid and the corresponding function is <code>st_centroid</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a>centroids_old <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(old_buildings) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(.,<span class="at">crs=</span><span class="dv">28992</span>)  </span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> single_old_buffer, <span class="fu">aes</span>(<span class="at">fill=</span>ID)) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> centroids_old)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="centroids-1" class="slide level2">
<h2>Centroids</h2>

<img data-src="fig/rmd-04b-centroids-1.png" class="r-stretch quarto-figure-center"></section>
<section id="intersection" class="slide level2">
<h2>Intersection</h2>
<p>Now what we would like to distinguish conservation areas based on the number of historic buildings they contain. In GIS terms, we would like to know how many centroids each fused buffer polygon contains. This operation means intersecting the layer of polygons with the layer of points and the corresponding function is <code>st_intersection</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a> centroids_buffers <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(centroids_old,single_old_buffer) <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2"></a>   <span class="fu">add_column</span>(<span class="at">n=</span><span class="dv">1</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a> centroid_by_buffer <span class="ot">&lt;-</span> centroids_buffers <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5"></a>   <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>   <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n))</span>
<span id="cb16-7"><a href="#cb16-7"></a> </span>
<span id="cb16-8"><a href="#cb16-8"></a> single_buffer <span class="ot">&lt;-</span> single_old_buffer <span class="sc">|&gt;</span> </span>
<span id="cb16-9"><a href="#cb16-9"></a>   <span class="fu">add_column</span>(<span class="at">n_buildings =</span> centroid_by_buffer<span class="sc">$</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="challenge-visualise-the-new-buffers" class="slide level2">
<h2>‚è∞Challenge: visualise the new buffers</h2>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_cd6a0d1f" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">‚àí</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<p>Represent visually how many buildings are contained in each of the new buffers</p>
</section>
<section id="solution-one-of-them-1" class="slide level2">
<h2>Solution (one of them)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb17-2"><a href="#cb17-2"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> single_buffer, <span class="fu">aes</span>(<span class="at">fill=</span>n_buildings)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>   <span class="fu">scale_fill_viridis_c</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb17-4"><a href="#cb17-4"></a>                        <span class="at">begin =</span> <span class="fl">0.6</span>,</span>
<span id="cb17-5"><a href="#cb17-5"></a>                        <span class="at">end =</span> <span class="dv">1</span>,</span>
<span id="cb17-6"><a href="#cb17-6"></a>                        <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb17-7"><a href="#cb17-7"></a>                        <span class="at">option =</span> <span class="st">"B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="fig/rmd-04b-intersection-1.png" class="r-stretch quarto-figure-center"></section>
<section id="final-output" class="slide level2">
<h2>Final output:</h2>
<p>Let‚Äôs map this layer over the initial map of individual buildings.</p>

<img data-src="fig/rmd-04b-visu-1800-1.png" class="r-stretch quarto-figure-center"></section>
<section id="final-output-1" class="slide level2">
<h2>Final output:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb18-2"><a href="#cb18-2"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> buildings) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> single_buffer, <span class="fu">aes</span>(<span class="at">fill=</span>n_buildings), <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>   <span class="fu">scale_fill_viridis_c</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>                        <span class="at">begin =</span> <span class="fl">0.6</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>                        <span class="at">end =</span> <span class="dv">1</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>                        <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>                        <span class="at">option =</span> <span class="st">"B"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="challenge-map-the-new-conservation-rules" class="slide level2">
<h2>‚è∞Challenge: map the new conservation rules</h2>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_16738e70" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">‚àí</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">15</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<p>Conservation rules have changed! The historical threshold now applies to all <strong>pre-war buildings</strong>, but the distance to these building is reduced to <strong>100 meters</strong>. Can you map the number of all buildings per 100m fused buffer?</p>

<img data-src="fig/rmd-04b-prewar-replication-1.png" class="r-stretch quarto-figure-center"></section>
<section id="solution-one-of-them-2" class="slide level2">
<h2>Solution (one of them)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a> old <span class="ot">&lt;-</span> <span class="dv">1939</span> </span>
<span id="cb19-2"><a href="#cb19-2"></a> distance <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb19-3"><a href="#cb19-3"></a> <span class="co">#select</span></span>
<span id="cb19-4"><a href="#cb19-4"></a> old_buildings <span class="ot">&lt;-</span> <span class="fu">filter</span>(buildings, start_date <span class="sc">&lt;=</span> old)</span>
<span id="cb19-5"><a href="#cb19-5"></a> <span class="co">#buffer</span></span>
<span id="cb19-6"><a href="#cb19-6"></a> buffer_old_buildings <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(old_buildings, <span class="at">dist =</span> distance)</span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="co">#union</span></span>
<span id="cb19-8"><a href="#cb19-8"></a> single_old_buffer <span class="ot">&lt;-</span> <span class="fu">st_union</span>(buffer_old_buildings) <span class="sc">|&gt;</span> </span>
<span id="cb19-9"><a href="#cb19-9"></a>   <span class="fu">st_cast</span>(<span class="at">to =</span> <span class="st">"POLYGON"</span>) <span class="sc">|&gt;</span> <span class="fu">st_as_sf</span>()  <span class="sc">|&gt;</span> </span>
<span id="cb19-10"><a href="#cb19-10"></a>   <span class="fu">add_column</span>(<span class="st">"ID"</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))  <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(.,<span class="at">crs=</span><span class="dv">4326</span>) </span>
<span id="cb19-11"><a href="#cb19-11"></a> <span class="co">#centroids</span></span>
<span id="cb19-12"><a href="#cb19-12"></a> centroids_old <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(old_buildings) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(.,<span class="at">crs=</span><span class="dv">4326</span>)  </span>
<span id="cb19-13"><a href="#cb19-13"></a>  <span class="co">#intersection</span></span>
<span id="cb19-14"><a href="#cb19-14"></a>  centroids_buffers <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(centroids_old,single_old_buffer) <span class="sc">|&gt;</span> </span>
<span id="cb19-15"><a href="#cb19-15"></a>   <span class="fu">add_column</span>(<span class="at">n=</span><span class="dv">1</span>)</span>
<span id="cb19-16"><a href="#cb19-16"></a> centroid_by_buffer <span class="ot">&lt;-</span> centroids_buffers <span class="sc">|&gt;</span> </span>
<span id="cb19-17"><a href="#cb19-17"></a>   <span class="fu">group_by</span>(ID) <span class="sc">|&gt;</span></span>
<span id="cb19-18"><a href="#cb19-18"></a>   <span class="fu">summarise</span>(</span>
<span id="cb19-19"><a href="#cb19-19"></a>   <span class="at">n =</span> <span class="fu">sum</span>(n)</span>
<span id="cb19-20"><a href="#cb19-20"></a>   )</span>
<span id="cb19-21"><a href="#cb19-21"></a> single_buffer <span class="ot">&lt;-</span> single_old_buffer <span class="sc">|&gt;</span> <span class="fu">add_column</span>(<span class="at">n_buildings =</span> centroid_by_buffer<span class="sc">$</span>n)</span>
<span id="cb19-22"><a href="#cb19-22"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb19-23"><a href="#cb19-23"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> buildings) <span class="sc">+</span></span>
<span id="cb19-24"><a href="#cb19-24"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> single_buffer, <span class="fu">aes</span>(<span class="at">fill=</span>n_buildings), <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb19-25"><a href="#cb19-25"></a>   <span class="fu">scale_fill_viridis_c</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb19-26"><a href="#cb19-26"></a>                        <span class="at">begin =</span> <span class="fl">0.6</span>,</span>
<span id="cb19-27"><a href="#cb19-27"></a>                        <span class="at">end =</span> <span class="dv">1</span>,</span>
<span id="cb19-28"><a href="#cb19-28"></a>                        <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb19-29"><a href="#cb19-29"></a>                        <span class="at">option =</span> <span class="st">"B"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="challenge-visualise-the-density-of-old-buildings" class="slide level2">
<h2>‚è∞ Challenge: visualise the density of old buildings</h2>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_44c0289a" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">‚àí</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<p>There are many pre-war buildings and the buffers are large so the number of old buildings is not very meaningful.</p>
<p>Let‚Äôs compute the <strong>density</strong> of old buildings per buffer zone (= number of buildings / area of buffer).</p>

<img data-src="fig/rmd-04b-area-1.png" class="r-stretch quarto-figure-center"></section>
<section id="problem-how-to-compute-the-area-of-a-polygon" class="slide level2">
<h2>Problem: how to compute the area of a polygon?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>single_buffer<span class="sc">$</span>area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(single_buffer) <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  units<span class="sc">::</span><span class="fu">set_units</span>(., km<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>single_buffer<span class="sc">$</span>old_buildings_per_km2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(single_buffer<span class="sc">$</span>n_buildings <span class="sc">/</span> single_buffer<span class="sc">$</span>area)</span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb20-7"><a href="#cb20-7"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> buildings) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> single_buffer, <span class="fu">aes</span>(<span class="at">fill=</span>old_buildings_per_km2), <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>   <span class="fu">scale_fill_viridis_c</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb20-10"><a href="#cb20-10"></a>                        <span class="at">begin =</span> <span class="fl">0.6</span>,</span>
<span id="cb20-11"><a href="#cb20-11"></a>                        <span class="at">end =</span> <span class="dv">1</span>,</span>
<span id="cb20-12"><a href="#cb20-12"></a>                        <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb20-13"><a href="#cb20-13"></a>                        <span class="at">option =</span> <span class="st">"B"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary-and-keypoints-1" class="slide level2">
<h2>Summary and keypoints</h2>
<p>We have seen how to create spatial buffers and centroids, how to intersect vector data and how retrieve the area of polygons.</p>
<p>In short:</p>
<ul>
<li class="fragment">Use the <code>sf</code> package to treat geospatial data</li>
<li class="fragment">Use the <code>st_*</code> functions for basic GIS operations</li>
<li class="fragment">Use the <code>ggplot</code> package to map the results</li>
</ul>
</section></section>
<section>
<section id="session-4c-manipulating-rater-and-vector-data" class="title-slide slide level1 center">
<h1>Session 4c: Manipulating rater and vector data</h1>
<p>How can I crop raster objects to vector objects, and extract the summary of raster pixels?</p>
</section>
<section id="objectives-keypoints" class="slide level2">
<h2>Objectives &amp; Keypoints:</h2>
<ul>
<li class="fragment">Crop a raster to the extent of a vector layer.</li>
<li class="fragment">Extract values from a raster that correspond to a vector file overlay.</li>
<li class="fragment">Use the <code>crop()</code> function to crop a raster object.</li>
<li class="fragment">Use the <code>extract()</code> function to extract pixels from a raster object that fall within a particular extent boundary.</li>
<li class="fragment"></li>
</ul>
</section>
<section id="introduction" class="slide level2">
<h2>Introduction</h2>
<p>We often work with spatial layers that have different spatial extents. The spatial extent of a shapefile or R spatial object represents the geographic ‚Äúedge‚Äù or location that is the furthest north, south east and west. Thus is represents the overall geographic coverage of the spatial object.</p>

<img data-src="fig/spatial_extent.png" class="r-stretch quarto-figure-center"><p class="caption">Image Source: National Ecological Observatory Network (NEON)</p></section>
<section id="introduction-1" class="slide level2">
<h2>Introduction</h2>
<p>The graphic below illustrates the extent of several of the spatial layers that we have worked with in this workshop:</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="fig/rmd-11-compare-data-extents-1.png"></p>
<p></p><figcaption>Image Source: DCC</figcaption><p></p>
</figure>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li class="fragment">Area of interest (AOI) ‚Äì blue</li>
<li class="fragment">Roads and trails ‚Äì purple</li>
<li class="fragment">Vegetation plot locations (marked with white dots)‚Äì black</li>
<li class="fragment">A canopy height model (CHM) in GeoTIFF format ‚Äì green</li>
</ul>
</div>
</div>
</section>
<section id="introduction-2" class="slide level2">
<h2>Introduction</h2>
<p>Frequent use cases of cropping a raster file include</p>
<ul>
<li class="fragment">reducing file size</li>
<li class="fragment">creating maps.</li>
</ul>
<p>Sometimes we have a raster file that is much larger than our study area or area of interest. It is often more efficient to crop the raster to the extent of our study area to reduce file sizes as we process our data.</p>
<p>Cropping a raster can also be useful when creating pretty maps so that the raster layer matches the extent of the desired vector layers.</p>
</section>
<section id="import-the-raster" class="slide level2">
<h2>Import the raster</h2>
<p>We import a <em>DSM</em> (Digital Surface Model) and a <em>DTM</em> (Digital Terrain Model) of TU-Delft.</p>
<p>The difference between the two altitudes gives us a <em>CHM</em>, a Canopy Height Model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>DSM_TUD <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"tud-dsm.tif"</span>))</span>
<span id="cb21-2"><a href="#cb21-2"></a>DTM_TUD <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"tud-dtm.tif"</span>))</span>
<span id="cb21-3"><a href="#cb21-3"></a>CHM_TUD <span class="ot">&lt;-</span> DSM_TUD <span class="sc">-</span> DTM_TUD</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a>CHM_TUD_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(CHM_TUD, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a>oai_boundary_tudlib <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(<span class="fu">raster</span>(<span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"tudlib-rgb.tif"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>st_as_sfc()</code> is a useful function to convert files to an <code>sf</code> format.</p>
</section>
<section id="crop-a-raster-using-vector-extent" class="slide level2">
<h2>Crop a Raster Using Vector Extent</h2>
<p>We can use the <code>crop()</code> function to crop a raster to the extent of another spatial object. To do this, we need to specify the raster to be cropped and the spatial object that will be used to crop the raster. R will use the extent of the spatial object as the cropping boundary.</p>
<p>To illustrate this, we will crop the Canopy Height Model (CHM) to only include the <strong>area of interest (AOI)</strong>. Let‚Äôs start by plotting the full extent of the CHM data and overlay where the AOI falls within it. The boundaries of the AOI will be colored blue, and we use <code>fill = NA</code> to make the area transparent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> CHM_TUD_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> layer)) <span class="sc">+</span> </span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">name =</span> <span class="st">"Canopy Height"</span>, <span class="at">colors =</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> oai_boundary_tudlib, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">coord_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crop-a-raster-using-vector-extent-1" class="slide level2">
<h2>Crop a Raster Using Vector Extent</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="fig/rmd-04c-from-ep2-1.png"></p>
</div><div class="column" style="width:50%;">
<p>Now that we have visualized the area of the CHM we want to subset, we can perform the cropping operation. We are going to use the <code>crop()</code> function from the <code>raster</code> package to create a new object with only the portion of the CHM data that falls within the boundaries of the AOI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>CHM_TUD_Cropped <span class="ot">&lt;-</span> <span class="fu">crop</span>(</span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="at">x =</span> CHM_TUD,</span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="at">y =</span> <span class="fu">st_as_sf</span>(oai_boundary_tudlib)</span>
<span id="cb23-4"><a href="#cb23-4"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="crop-a-raster-using-vector-extent-2" class="slide level2">
<h2>Crop a Raster Using Vector Extent</h2>
<p>Now we can plot: - the cropped CHM data - a boundary box showing the full CHM extent.</p>
<p>However, remember, since this is raster data, we need to convert to a data frame in order to plot using ggplot.</p>
</section>
<section id="crop-a-raster-using-vector-extent-3" class="slide level2">
<h2>Crop a Raster Using Vector Extent</h2>
<p>To get the boundary box from CHM, the <code>st_bbox()</code> will extract the 4 corners of the rectangle that encompass all the features contained in this object. The <code>st_as_sfc()</code> converts these 4 coordinates into a polygon that we can plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>CHM_TUD_Cropped_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(CHM_TUD_Cropped, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(CHM_TUD)), <span class="at">fill =</span> <span class="st">"green"</span>,</span>
<span id="cb24-6"><a href="#cb24-6"></a>          <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb24-7"><a href="#cb24-7"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> CHM_TUD_Cropped_df,</span>
<span id="cb24-8"><a href="#cb24-8"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> layer)) <span class="sc">+</span> </span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">name =</span> <span class="st">"Canopy Height"</span>, <span class="at">colors =</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb24-10"><a href="#cb24-10"></a>  <span class="fu">coord_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crop-a-raster-using-vector-extent-4" class="slide level2">
<h2>Crop a Raster Using Vector Extent</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="fig/rmd-04c-unnamed-chunk-4-1.png"></p>
</div><div class="column" style="width:50%;">
<p>The plot shows that the full CHM extent (plotted in green) is much larger than the resulting cropped raster. Our new cropped CHM now has the same extent as the aoi_boundary_HARV object that was used as a crop extent (blue border below).</p>
</div>
</div>
</section>
<section id="crop-a-raster-using-vector-extent-5" class="slide level2">
<h2>Crop a Raster Using Vector Extent</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="fig/rmd-04c-unnamed-chunk-5-1.png"></p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_as_sfc</span>(</span>
<span id="cb25-3"><a href="#cb25-3"></a>    <span class="fu">st_bbox</span>(CHM_TUD)), </span>
<span id="cb25-4"><a href="#cb25-4"></a>          <span class="at">fill =</span> <span class="st">"green"</span>,</span>
<span id="cb25-5"><a href="#cb25-5"></a>          <span class="at">color =</span> <span class="st">"green"</span>, </span>
<span id="cb25-6"><a href="#cb25-6"></a>          <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> CHM_TUD_Cropped_df,</span>
<span id="cb25-8"><a href="#cb25-8"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb25-9"><a href="#cb25-9"></a>                  <span class="at">y =</span> y, </span>
<span id="cb25-10"><a href="#cb25-10"></a>                  <span class="at">fill =</span> layer)) <span class="sc">+</span> </span>
<span id="cb25-11"><a href="#cb25-11"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb25-12"><a href="#cb25-12"></a>    <span class="at">name =</span> <span class="st">"Canopy Height"</span>, </span>
<span id="cb25-13"><a href="#cb25-13"></a>    <span class="at">colors =</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb25-14"><a href="#cb25-14"></a>  <span class="fu">coord_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This plot shows that the full CHM extent (plotted in green) is much larger than the resulting cropped raster.</p>
</div>
</div>
</section>
<section id="crop-a-raster-using-vector-extent-6" class="slide level2">
<h2>Crop a Raster Using Vector Extent</h2>
<p>We can look at the extent of all of our other objects for this field site.</p>
<p>The original:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">st_bbox</span>(CHM_TUD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The cropped one:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">st_bbox</span>(CHM_TUD_Cropped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The area of interest:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">st_bbox</span>(oai_boundary_tudlib)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our plot location extent is not the largest but is larger than the AOI Boundary.</p>
</section>
<section id="extract-raster-pixels-values-using-vector-polygons" class="slide level2">
<h2>Extract Raster Pixels Values Using Vector Polygons</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Often we want to extract values from a raster layer for particular locations - for example, plot locations that we are sampling on the ground.</p>
<p>We can extract all pixel values within 20m of our x,y point of interest. These can then be summarized into some value of interest (e.g.&nbsp;mean, maximum, total).</p>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="fig/BufferSquare.png"></p>
<p></p><figcaption>Image Source: National Ecological Observatory Network (NEON)</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="extract-raster-pixels-values-using-vector-polygons-1" class="slide level2">
<h2>Extract Raster Pixels Values Using Vector Polygons</h2>
<p>To do this in R, we use the <code>extract()</code> function. The <code>extract()</code> function requires:</p>
<ul>
<li class="fragment">The raster that we wish to extract values from,</li>
<li class="fragment">The vector layer containing the polygons that we wish to use as a boundary or boundaries.</li>
</ul>
<p>We can tell it to store the output values in a data frame using <code>df = TRUE</code>. (This is optional, the default is to return a list, NOT a data frame.)</p>
<p>We will begin by extracting all canopy height pixel values located within our <code>oai_boundary_tudlib</code> polygon which surrounds the TU Delft Library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>tree_height <span class="ot">&lt;-</span> <span class="fu">extract</span>(<span class="at">x =</span> CHM_TUD, </span>
<span id="cb29-2"><a href="#cb29-2"></a>                       <span class="at">y =</span> <span class="fu">st_as_sf</span>(oai_boundary_tudlib),</span>
<span id="cb29-3"><a href="#cb29-3"></a>                       <span class="at">df =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-4"><a href="#cb29-4"></a></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="fu">str</span>(tree_height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we use the <code>extract()</code> function, R extracts the value for each pixel located within the boundary of the polygon being used to perform the extraction - in this case the <code>oai_boundary_tudlib</code> object (a single polygon). Here, the function extracted values from 621,642 pixels.</p>
</section>
<section id="extract-raster-pixels-values-using-vector-polygons-2" class="slide level2">
<h2>Extract Raster Pixels Values Using Vector Polygons</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>We can create a histogram of tree height values within the boundary to better understand the structure or height distribution of trees at our site. We will use the column <code>layer</code> from our data frame as our x values, as this column represents the tree heights for each pixel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> tree_height, <span class="fu">aes</span>(<span class="at">x =</span> layer)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">ggtitle</span>(<span class="st">"Histogram of CHM Height Values (m)"</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="fu">xlab</span>(<span class="st">"Tree Height"</span>) <span class="sc">+</span> </span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">ylab</span>(<span class="st">"Frequency of Pixels"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also use the <code>summary()</code> function to view descriptive statistics including min, max, and mean height values. These values help us better understand vegetation at our field site.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">summary</span>(tree_height<span class="sc">$</span>layer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><img data-src="fig/rmd-04c-unnamed-chunk-16-1.png"></p>
</div>
</div>
</section>
<section id="summarize-extracted-raster-values" class="slide level2">
<h2>Summarize Extracted Raster Values</h2>
<p>We often want to extract summary values from a raster.</p>
<p>We can tell R the type of summary statistic we are interested in using the <code>fun = argument</code>.</p>
<p>Let‚Äôs extract a mean height value for our AOI. Because we are extracting only a single number, we will not use the <code>df = TRUE</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>mean_tree_height_AOI <span class="ot">&lt;-</span> <span class="fu">extract</span>(</span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="at">x =</span> CHM_TUD, </span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="at">y =</span> <span class="fu">st_as_sf</span>(oai_boundary_tudlib), </span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="at">fun =</span> mean)</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="fu">head</span>(mean_tree_height_AOI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It appears that the mean height value, extracted from our LiDAR data derived canopy height model is 4.3 meters.</p>
</section>
<section id="extract-data-using-xy-locations" class="slide level2">
<h2>Extract Data using x,y Locations</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>We can also extract pixel values from a raster by defining a buffer or area surrounding individual point locations using the <code>extract()</code> function.</p>
<p>To do this we define the summary argument (<code>fun = mean</code>) and the buffer distance (<code>buffer = 20</code>) which represents the radius of a circular region around each point.</p>
<p>By default, the units of the buffer are the same units as the data‚Äôs CRS. All pixels that are touched by the buffer region are included in the extract.</p>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="fig/BufferCircular.png"></p>
<p></p><figcaption>Image Source:National Ecological Observatory Network (NEON)</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="extract-data-using-xy-locations-1" class="slide level2">
<h2>Extract Data using x,y Locations</h2>
<p>Let‚Äôs put this into practice by figuring out the mean tree height in the 20m around the tower location (<code>point_Delft</code>). Because we are extracting only a single number, we will not use the <code>df = TRUE</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>point_Delft <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"delft-leisure.shp"</span>))</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a>mean_tree_height_tower <span class="ot">&lt;-</span> <span class="fu">extract</span>(<span class="at">x =</span> CHM_TUD,</span>
<span id="cb33-4"><a href="#cb33-4"></a>                                  <span class="at">y =</span> point_Delft,</span>
<span id="cb33-5"><a href="#cb33-5"></a>                                  <span class="at">buffer =</span> <span class="dv">20</span>,</span>
<span id="cb33-6"><a href="#cb33-6"></a>                                  <span class="at">fun =</span> mean)</span>
<span id="cb33-7"><a href="#cb33-7"></a></span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="fu">head</span>(mean_tree_height_tower)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="challenge-extract-raster-height-values-for-plot-locations" class="slide level2">
<h2>‚è∞ Challenge: Extract Raster Height Values For Plot Locations</h2>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_679d58a1" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">‚àí</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li class="fragment"><p>Use the leisure locations object (<code>point_Delft</code>) to extract an average tree height for the area within 20m of each playground and picnic table in the study area. Because there are multiple playgrounds and picnic tables, there will be multiple averages returned, so the <code>df = TRUE</code> argument should be used.</p></li>
<li class="fragment"><p>Create a plot showing the mean tree height of each area.</p></li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="fig/rmd-04c-unnamed-chunk-21-1.png"></p>
</div>
</div>
</section>
<section id="solution-1" class="slide level2">
<h2>Solution</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>leisure_locations_selection <span class="ot">&lt;-</span> point_Delft <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">filter</span>(leisure <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"playground"</span>, <span class="st">"picnic_table"</span>))</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># extract data at each plot location</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>mean_tree_height_plots_TUD <span class="ot">&lt;-</span> <span class="fu">extract</span>(<span class="at">x =</span> CHM_TUD,</span>
<span id="cb34-6"><a href="#cb34-6"></a>                                       <span class="at">y =</span> leisure_locations_selection,</span>
<span id="cb34-7"><a href="#cb34-7"></a>                                       <span class="at">buffer =</span> <span class="dv">20</span>,</span>
<span id="cb34-8"><a href="#cb34-8"></a>                                       <span class="at">fun =</span> mean,</span>
<span id="cb34-9"><a href="#cb34-9"></a>                                       <span class="at">df =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-10"><a href="#cb34-10"></a></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co"># view data</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="fu">head</span>(mean_tree_height_plots_TUD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualisation of the results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mean_tree_height_plots_TUD, <span class="fu">aes</span>(ID, layer)) <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">ggtitle</span>(<span class="st">"Mean Tree Height at each Plot"</span>) <span class="sc">+</span> </span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="fu">xlab</span>(<span class="st">"Plot ID"</span>) <span class="sc">+</span> </span>
<span id="cb35-5"><a href="#cb35-5"></a>  <span class="fu">ylab</span>(<span class="st">"Tree Height (m)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary-and-keypoints-2" class="slide level2">
<h2>Summary and keypoints</h2>
<p>We have seen how to crop a raster to the extent of a vector layer and how to extract values from a raster that correspond to a vector file overlay.</p>
<p>In short:</p>
<ul>
<li class="fragment">Use the <code>crop()</code> function to crop a raster object.</li>
<li class="fragment">Use the <code>extract()</code> function to extract pixels from a raster object that fall within a particular extent boundary.</li>
</ul>

<img src="BKTUD.png" class="slide-logo r-stretch"><div class="footer footer-default">
<p>Data Carpentry for Geospatial Data</p>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="session4_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="session4_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="session4_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="session4_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="session4_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="session4_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="session4_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="session4_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="session4_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="session4_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="session4_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        function fireSlideChanged(previousSlide, currentSlide) {

          // dispatch for htmlwidgets
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for reveal
        if (window.Reveal) {
          window.Reveal.addEventListener("slidechanged", function(event) {
            fireSlideChanged(event.previousSlide, event.currentSlide);
          });
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

</body></html>